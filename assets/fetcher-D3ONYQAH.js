import{R as l}from"./iframe-5eZmOUV9.js";const h=t=>{let e;const s=new Set,a=(n,c)=>{const o=typeof n=="function"?n(e):n;if(!Object.is(o,e)){const g=e;e=c??(typeof o!="object"||o===null)?o:Object.assign({},e,o),s.forEach(w=>w(e,g))}},r=()=>e,i={setState:a,getState:r,getInitialState:()=>u,subscribe:n=>(s.add(n),()=>s.delete(n))},u=e=t(a,r,i);return i},_=(t=>t?h(t):h),b=t=>t;function A(t,e=b){const s=l.useSyncExternalStore(t.subscribe,l.useCallback(()=>e(t.getState()),[t,e]),l.useCallback(()=>e(t.getInitialState()),[t,e]));return l.useDebugValue(s),s}const d=t=>{const e=_(t),s=a=>A(e,a);return Object.assign(s,e),s},I=(t=>t?d(t):d),k=I(t=>({accessToken:null,setAccessToken:e=>t({accessToken:e}),logout:()=>t({accessToken:null})}));var y={};const E=y.NEXT_PUBLIC_API_URL;async function $(){try{const t=await fetch(`${E}/auth/refresh`,{method:"POST",credentials:"include"});if(!t.ok)return null;const s=(await t.json()).accessToken;return k.getState().setAccessToken(s),s}catch{return null}}var j={};const S=j.NEXT_PUBLIC_API_URL;async function m(t,e){const{headers:s,noAuth:a,...r}=e,{accessToken:T,setAccessToken:f,logout:i}=k.getState(),u={"Content-Type":"application/json"};let n=await fetch(`${S}${t}`,{headers:{...u,...s},cache:"no-store",...r});if(n.status===401&&!a){const c=await $();if(c)f(c),u.Authorization=`Bearer ${c}`,n=await fetch(`${S}${t}`,{headers:{...u,...s},cache:"no-store",...r});else throw i(),new Error("세션이 만료되었습니다. 다시 로그인 해주세요.")}if(!n.ok){let c=`API Error ${n.status}`;try{const o=await n.json();c=o.message??o.detail??c}catch{const o=await n.text();o&&(c=o)}throw new Error(c)}return n.json()}export{m as a,k as u};
