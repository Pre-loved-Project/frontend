async function w(n,o=.8){return new Promise((s,r)=>{const e=new Image,c=URL.createObjectURL(n);e.onload=()=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const a=t.getContext("2d");if(!a)return r("Canvas context error");a.drawImage(e,0,0),t.toBlob(i=>{i?s(i):r("WebP 변환 실패"),URL.revokeObjectURL(c)},"image/webp",o)},e.onerror=r,e.src=c})}var d={};const m=d.NEXT_PUBLIC_API_URL;async function g(n){try{const o=await w(n),s=new File([o],n.name.replace(/\.[^.]+$/,".webp"),{type:"image/webp"}),r=new FormData;r.append("image",s);const e=await fetch(`${m}/api/image`,{method:"POST",body:r});if(!e.ok){let t=`업로드 실패 (code ${e.status})`;try{const a=await e.json();t=a.detail||a.message||t}catch{const a=await e.text();a&&(t=a)}throw new Error(t)}return(await e.json()).imageUrl}catch(o){throw console.error("이미지 업로드 중 오류 발생:",o),o instanceof Error?new Error(o.message):new Error("알 수 없는 오류가 발생했습니다.")}}export{g as u};
