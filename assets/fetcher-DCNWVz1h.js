import{u}from"./auth.store-CILsHpKA.js";var l={};const _=l.NEXT_PUBLIC_API_URL;async function w(){try{const s=await fetch(`${_}/auth/refresh`,{method:"POST",credentials:"include"});if(!s.ok)return null;const a=(await s.json()).accessToken;return u.getState().setAccessToken(a),a}catch{return null}}var A={};const i=A.NEXT_PUBLIC_API_URL;async function $(s,r){const{headers:a,noAuth:h,...c}=r,{accessToken:T,setAccessToken:f,logout:d}=u.getState(),o={"Content-Type":"application/json"};let t=await fetch(`${i}${s}`,{headers:{...o,...a},cache:"no-store",...c});if(t.status===401&&!h){const e=await w();if(e)f(e),o.Authorization=`Bearer ${e}`,t=await fetch(`${i}${s}`,{headers:{...o,...a},cache:"no-store",...c});else throw d(),new Error("세션이 만료되었습니다. 다시 로그인 해주세요.")}if(!t.ok){let e=`API Error ${t.status}`;try{const n=await t.json();e=n.message??n.detail??e}catch{const n=await t.text();n&&(e=n)}throw new Error(e)}return t.json()}export{$ as a};
