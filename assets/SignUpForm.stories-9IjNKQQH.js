import{j as u}from"./jsx-runtime-C79o4nij.js";import{R as E,r as m}from"./iframe-DJRBywMH.js";import{I as v}from"./Input-D3n4ECTL.js";import{D as U}from"./DropDown-DAoH7l0U.js";import{B as W}from"./Button-BhQH-Zsq.js";import"./preload-helper-PPVm8Dsz.js";import"./cn-DWDuF9m2.js";import"./TextField-CqNiadPu.js";import"./image-BTAhzXMi.js";import"./use-merged-ref-DTMwRsOZ.js";const B=e=>{let t;const o=new Set,d=(n,l)=>{const a=typeof n=="function"?n(t):n;if(!Object.is(a,t)){const k=t;t=l??(typeof a!="object"||a===null)?a:Object.assign({},t,a),o.forEach(h=>h(t,k))}},g=()=>t,i={setState:d,getState:g,getInitialState:()=>p,subscribe:n=>(o.add(n),()=>o.delete(n))},p=t=e(d,g,i);return i},Z=(e=>e?B(e):B),ee=e=>e;function te(e,t=ee){const o=E.useSyncExternalStore(e.subscribe,E.useCallback(()=>t(e.getState()),[e,t]),E.useCallback(()=>t(e.getInitialState()),[e,t]));return E.useDebugValue(o),o}const L=e=>{const t=Z(e),o=d=>te(t,d);return Object.assign(o,t),o},se=(e=>e?L(e):L),z=se(e=>({accessToken:null,setAccessToken:t=>e({accessToken:t}),logout:()=>e({accessToken:null})}));var re={};const ne=re.NEXT_PUBLIC_API_URL;async function ae(){try{const e=await fetch(`${ne}/auth/refresh`,{method:"POST",credentials:"include"});if(!e.ok)return null;const o=(await e.json()).accessToken;return z.getState().setAccessToken(o),o}catch{return null}}var oe={};const M=oe.NEXT_PUBLIC_API_URL;async function R(e,t){const{headers:o,noAuth:d,...g}=t,{accessToken:f,setAccessToken:S,logout:i}=z.getState(),p={"Content-Type":"application/json"};let n=await fetch(`${M}${e}`,{headers:{...p,...o},cache:"no-store",...g});if(n.status===401&&!d){const l=await ae();if(l)S(l),p.Authorization=`Bearer ${l}`,n=await fetch(`${M}${e}`,{headers:{...p,...o},cache:"no-store",...g});else throw i(),new Error("세션이 만료되었습니다. 다시 로그인 해주세요.")}if(!n.ok){let l=`API Error ${n.status}`;try{const a=await n.json();l=a.message??a.detail??l}catch{const a=await n.text();a&&(l=a)}throw new Error(l)}return n.json()}const F=({size:e="lg",onSuccess:t,onError:o})=>{const[d,g]=m.useState(""),[f,S]=m.useState(""),[i,p]=m.useState(""),[n,l]=m.useState(""),[a,k]=m.useState(""),[h,O]=m.useState(""),[T,_]=m.useState(""),[A,C]=m.useState(null),[$,P]=m.useState(null),[I,D]=m.useState(null),[N,y]=m.useState(null),H=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),q=r=>{const s=r.target.value;g(s),s&&!H(s)?C("올바른 이메일 형식이 아닙니다."):C(null)},V=r=>{const s=r.target.value;S(s),s.length>10?P("닉네임은 최대 10자 이하이어야 합니다."):P(null)},X=r=>{const s=r.target.value;p(s),s&&s.length<8?D("비밀번호는 최소 8자 이상이어야 합니다."):D(null)},G=r=>{const s=r.target.value;l(s),y(i&&s&&i!==s?"비밀번호가 일치하지 않습니다.":null)};m.useEffect(()=>{y(i&&n&&i!==n?"비밀번호가 일치하지 않습니다.":null)},[i,n]);const J=Array.from({length:126},(r,s)=>{const c=1900+s;return{label:`${c}년`,value:c}}),Y=()=>a?Array.from({length:12},(r,s)=>{const c=s+1;return{label:`${c}월`,value:c}}):[],K=()=>{if(!a||!h)return[];const r=new Date(a,h,0).getDate();return Array.from({length:r},(s,c)=>{const w=c+1;return{label:`${w}일`,value:w}})},Q=async r=>{r.preventDefault(),console.log("회원가입 요청 폼 제출");const s=await R("/health",{method:"GET",noAuth:!0});console.log(s);try{const c={email:d,nickname:f,birthDate:`${a}-${String(h).padStart(2,"0")}-${String(T).padStart(2,"0")}`,password:i};console.log(c);const w=await R("/auth/signup",{method:"POST",body:JSON.stringify(c),noAuth:!0});console.log("회원가입 성공:",w),t?.()}catch(c){console.error("회원가입 실패:",c+`
`),c instanceof Error&&(c.message.includes("isEmailUsed")?C("이미 사용 중인 이메일입니다."):c.message.includes("isNicknameUsed")?P("이미 사용 중인 닉네임입니다."):o?.("회원가입에 실패했습니다. 잠시 후 다시 시도해주세요."))}};return u.jsxs("form",{onSubmit:Q,className:"flex flex-col gap-6",children:[u.jsx(v,{size:e,label:"이메일",placeholder:"이메일을 입력해 주세요",isError:!!A,errorMessage:A??"",onChange:q}),u.jsx(v,{size:e,label:"닉네임",placeholder:"닉네임을 입력해 주세요",message:"최대 10자 가능",isError:!!$,errorMessage:$??"",onChange:V}),u.jsx(v,{size:e,label:"비밀번호",placeholder:"비밀번호를 입력해 주세요",message:"최소 8자 이상",isHiddenable:!0,isError:!!I,errorMessage:I??"",onChange:X}),u.jsx(v,{size:e,label:"비밀번호 확인",placeholder:"비밀번호를 한번 더 입력해 주세요",isHiddenable:!0,isError:!!N,errorMessage:N??"",onChange:G}),u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsx("label",{className:"font-medium text-black-900 text-[16px]",children:"생년월일"}),u.jsxs("div",{className:"flex gap-4",children:[u.jsx(U,{size:e,widthSize:"short",options:J,value:a,onChange:r=>{k(r),O(""),_("")},placeholder:"연도"}),u.jsx(U,{size:e,widthSize:"short",options:Y(),value:h,onChange:r=>{O(r),_("")},placeholder:"월"}),u.jsx(U,{size:e,widthSize:"short",options:K(),value:T,onChange:r=>_(r),placeholder:"일"})]})]}),u.jsx(W,{variant:"primary",size:e,type:"submit",className:"mt-6",disabled:!d||A!==null||!f||$!==null||!i||I!==null||!n||N!==null||!a||!h||!T,children:"가입하기"})]})};F.__docgenInfo={description:"",methods:[],displayName:"SignUpForm",props:{size:{required:!1,tsType:{name:"union",raw:'"sm" | "md" | "lg"',elements:[{name:"literal",value:'"sm"'},{name:"literal",value:'"md"'},{name:"literal",value:'"lg"'}]},description:"",defaultValue:{value:'"lg"',computed:!1}},onSuccess:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onError:{required:!1,tsType:{name:"signature",type:"function",raw:"(msg: string) => void",signature:{arguments:[{type:{name:"string"},name:"msg"}],return:{name:"void"}}},description:""}}};const Se={title:"AUTH/SignUpForm",component:F,parameters:{layout:"centered"},argTypes:{size:{control:{type:"radio"},options:["sm","md","lg"]},onSuccess:{action:"success"},onError:{action:"error"}}},b={args:{size:"lg"}},x={args:{size:"md"}},j={args:{size:"sm"}};b.parameters={...b.parameters,docs:{...b.parameters?.docs,source:{originalSource:`{
  args: {
    size: "lg"
  }
}`,...b.parameters?.docs?.source}}};x.parameters={...x.parameters,docs:{...x.parameters?.docs,source:{originalSource:`{
  args: {
    size: "md"
  }
}`,...x.parameters?.docs?.source}}};j.parameters={...j.parameters,docs:{...j.parameters?.docs,source:{originalSource:`{
  args: {
    size: "sm"
  }
}`,...j.parameters?.docs?.source}}};const ye=["Large","Medium","Small"];export{b as Large,x as Medium,j as Small,ye as __namedExportsOrder,Se as default};
